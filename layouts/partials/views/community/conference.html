{{/* å…¼å®¹å•ä¸ªitemå’Œå¤šä¸ªitemsçš„è°ƒç”¨æ–¹å¼ */}}
{{ $allItems := slice }}

{{/* å¦‚æœä¼ å…¥çš„æ˜¯å•ä¸ªitem */}}
{{ if .item }}
  {{ $allItems = slice .item }}
{{/* å¦‚æœä¼ å…¥çš„æ˜¯itemsåˆ—è¡¨ */}}
{{ else if .items }}
  {{ $allItems = .items }}
{{/* å¦‚æœä¼ å…¥çš„æ˜¯ç›´æ¥çš„é¡µé¢åˆ—è¡¨ */}}
{{ else if . }}
  {{ $allItems = . }}
{{ end }}

{{ if $allItems }}
  {{/* æ”¶é›†æ‰€æœ‰æœ‰æ•ˆçš„talké¡¹ç›® */}}
  {{ $validItems := slice }}
  
  {{ range $allItems }}
    {{ $item := . }}
    {{ $isValidTalk := false }}

    {{/* æ£€æŸ¥é¡¹ç›®æ˜¯å¦å±äº talk ç±»å‹ */}}
    {{ if and $item.File (strings.Contains $item.File.Path "talk/") }}
      {{ $isValidTalk = true }}
    {{ end }}
    
    {{ if eq $item.Section "talk" }}
      {{ $isValidTalk = true }}
    {{ end }}
    
    {{ if eq $item.Type "talk" }}
      {{ $isValidTalk = true }}
    {{ end }}
    
    {{ if and $item.Params.event (or $item.Params.location $item.Params.presentation) }}
      {{ $isValidTalk = true }}
    {{ end }}

    {{ if $isValidTalk }}
      {{ $validItems = $validItems | append $item }}
    {{ end }}
  {{ end }}

  {{ if $validItems }}
    {{/* æŒ‰æ—¥æœŸå€’åºæ’åº */}}
    {{ $sortedItems := sort $validItems "Date" "desc" }}
    
    {{/* æŒ‰å¹´ä»½åˆ†ç»„æ˜¾ç¤º */}}
    {{ $currentYear := "" }}
    
    {{ range $sortedItems }}
      {{ $item := . }}
      {{ $itemYear := dateFormat "2006" $item.Date }}
      
      {{/* å¦‚æœå¹´ä»½å˜åŒ–ï¼Œæ˜¾ç¤ºæ–°çš„å¹´ä»½æ ‡é¢˜ */}}
      {{ if ne $currentYear $itemYear }}
        {{ if ne $currentYear "" }}
          </div>
        {{ end }}
        
        <div class="mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ $itemYear }}</h2>
          <hr class="border-t-2 border-gray-300 mb-4">
        
        {{ $currentYear = $itemYear }}
      {{ end }}
      
      <div class="mb-4 border border-gray-200 rounded p-3">
        <div class="pl-2">
          <h3 class="font-semibold text-lg">{{ $item.Title }}</h3>
          
          {{ with $item.Params.event }}
            <p class="text-gray-600 italic">{{ . }}</p>
          {{ end }}
          
          <div class="text-sm text-gray-500 mt-1">
            {{ with $item.Params.location }}
              <span>ğŸ“ {{ . }}</span>
            {{ end }}
            
            {{ with $item.Date }}
              <span class="ml-2">ğŸ“… {{ dateFormat "January 2, 2006" . }}</span>
            {{ end }}
            
            {{ if and $item.Params.date_end (ne $item.Date $item.Params.date_end) }}
              {{ $endDate := time $item.Params.date_end }}
              <span> - {{ dateFormat "January 2, 2006" $endDate }}</span>
            {{ end }}
          </div>
          
          {{ with $item.Params.presentation }}
            <div class="mt-2">
              <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded">
                {{ . }}
              </span>
            </div>
          {{ end }}
          
          {{ with $item.Summary }}
            <p class="text-sm text-gray-600 mt-2">{{ . }}</p>
          {{ end }}
        </div>
      </div>
    {{ end }}
    
    {{/* å…³é—­æœ€åä¸€ä¸ªå¹´ä»½ç»„ */}}
    {{ if ne $currentYear "" }}
      </div>
    {{ end }}
  {{ else }}
    <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
      <p class="text-yellow-800">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä¼šè®®æ¼”ç¤ºã€‚</p>
    </div>
  {{ end }}
  
{{ else }}
  <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
    <p class="text-yellow-800">æ²¡æœ‰æ‰¾åˆ°é¡¹ç›®æ•°æ®ã€‚è¯·æ£€æŸ¥è°ƒç”¨æ–¹å¼ã€‚</p>
  </div>
{{ end }}
