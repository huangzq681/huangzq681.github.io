{{/* è°ƒè¯•ï¼šå°è¯•ä¸åŒçš„æ•°æ®æº */}}
{{ $talks := .Items }}
{{ if not $talks }}
  {{/* å°è¯•ç›´æ¥ä» talk å†…å®¹ç±»å‹è·å– */}}
  {{ $talks = where site.RegularPages "Type" "talk" }}
{{ end }}
{{ if not $talks }}
  {{/* å°è¯•ä»æ‰€æœ‰é¡µé¢ä¸­ç­›é€‰ */}}
  {{ $talks = where site.RegularPages "Section" "talk" }}
{{ end }}

{{ if $talks }}
  <p>æ‰¾åˆ° {{ len $talks }} ä¸ª talk æ¡ç›®</p>
  
  {{/* æŒ‰å¹´ä»½åˆ†ç»„ */}}
  {{ $grouped := dict }}
  {{ $years := slice }}
  {{ range $talks }}
    {{ $year := (time .Date).Format "2006" }}
    {{ $grouped = merge $grouped (dict $year (append (index $grouped $year | default slice) .)) }}
    {{ if not (in $years $year) }}
      {{ $years = $years | append $year }}
    {{ end }}
  {{ end }}

  {{/* æŒ‰å¹´ä»½å€’åºæ’åˆ— */}}
  {{ $sortedYears := sort $years "desc" }}

  {{/* æ¸²æŸ“æ¯å¹´çš„ä¼šè®® */}}
  {{ range $year := $sortedYears }}
    <h2 class="text-lg font-semibold mt-6 mb-2 border-b border-gray-300 pb-1">{{ $year }}</h2>
    <ul class="list-disc list-inside space-y-2">
      {{ range index $grouped $year }}
        <li>
          <span class="font-semibold">{{ .Title }}</span>
          {{ with .Params.event }}
            â€” <em>{{ . }}</em>
          {{ end }}
          <br>
          {{ with .Params.location }}
            ğŸ“ {{ . }}
          {{ end }}
          {{ with .Date }}
            Â· {{ dateFormat "January 2, 2006" . }}
          {{ end }}
          {{ if and .Params.date_end (ne .Date .Params.date_end) }}
            - {{ dateFormat "January 2, 2006" .Params.date_end }}
          {{ end }}
          <br>
          {{ with .Params.presentation }}
            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded">{{ . }}</span>
          {{ end }}
        </li>
      {{ end }}
    </ul>
  {{ end }}
{{ else }}
  <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
    <h3 class="font-semibold text-yellow-800">è°ƒè¯•ä¿¡æ¯</h3>
    <p>æ²¡æœ‰æ‰¾åˆ°ä»»ä½• talk å†…å®¹ã€‚è¯·æ£€æŸ¥ï¼š</p>
    <ul class="list-disc list-inside mt-2 text-yellow-700">
      <li>æ–‡ä»¶å¤¹ç»“æ„ï¼š<code>content/talk/2024-AGU/index.md</code></li>
      <li>ç¡®ä¿ front matter ä¸­æœ‰ <code>date</code> å­—æ®µ</li>
      <li>ç¡®ä¿ <code>draft: false</code> æˆ–æ²¡æœ‰ draft å­—æ®µ</li>
      <li>è¿è¡Œ <code>hugo server --buildDrafts</code> æµ‹è¯•è‰ç¨¿å†…å®¹</li>
    </ul>
    
    <details class="mt-4">
      <summary class="cursor-pointer font-medium">ç«™ç‚¹è°ƒè¯•ä¿¡æ¯</summary>
      <div class="mt-2 text-sm">
        <p>æ‰€æœ‰å†…å®¹ç±»å‹: {{ range site.Sections }}{{ .Section }} {{ end }}</p>
        <p>Talk é¡µé¢æ•°é‡: {{ len (where site.RegularPages "Section" "talk") }}</p>
      </div>
    </details>
  </div>
{{ end }}
