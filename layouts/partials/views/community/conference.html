{{/* 获取传入的项目数据 */}}
{{ $items := .item }}
{{ if not $items }}
  {{ $items = .Items }}
{{ end }}

{{ if $items }}
  {{/* 按年份分组会议数据 */}}
  {{ $grouped := dict }}
  {{ $years := slice }}
  
  {{ range $items }}
    {{ $year := (time .Date).Format "2006" }}
    {{ $currentYearItems := index $grouped $year | default slice }}
    {{ $grouped = merge $grouped (dict $year ($currentYearItems | append .)) }}
    {{ if not (in $years $year) }}
      {{ $years = $years | append $year }}
    {{ end }}
  {{ end }}

  {{/* 按年份倒序排列 */}}
  {{ $sortedYears := sort $years "desc" }}

  {{/* 渲染每年的会议 */}}
  {{ range $year := $sortedYears }}
    <h2 class="text-lg font-semibold mt-6 mb-2 border-b border-gray-300 pb-1">{{ $year }}</h2>
    <ul class="list-disc list-inside space-y-2">
      {{ range index $grouped $year }}
        <li>
          <span class="font-semibold">{{ .Title }}</span>
          {{ with .Params.event }}
            — <em>{{ . }}</em>
          {{ end }}
          <br>
          {{ with .Params.location }}
            📍 {{ . }}
          {{ end }}
          {{ with .Date }}
            · {{ dateFormat "January 2, 2006" . }}
          {{ end }}
          {{ if and .Params.date_end (ne .Date .Params.date_end) }}
            {{ $endDate := time .Params.date_end }}
            - {{ dateFormat "January 2, 2006" $endDate }}
          {{ end }}
          <br>
          {{ with .Params.presentation }}
            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded">{{ . }}</span>
          {{ end }}
        </li>
      {{ end }}
    </ul>
  {{ end }}
{{ else }}
  <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
    <p class="text-yellow-800">没有找到任何会议记录。</p>
    <p class="text-sm text-yellow-600 mt-2">请确保：</p>
    <ul class="list-disc list-inside text-sm text-yellow-600">
      <li>content/talk/ 目录中有内容文件</li>
      <li>内容文件包含必要的 front matter</li>
      <li>文件没有设置 draft: true</li>
    </ul>
  </div>
{{ end }}
